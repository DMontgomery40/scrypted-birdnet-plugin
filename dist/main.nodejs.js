(()=>{var e={562:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.sdk=t.MixinDeviceBase=t.ScryptedDeviceBase=void 0,o(r(192),t);const s=r(192);r(339);class n extends s.DeviceBase{constructor(e){super(),this.nativeId=e}get storage(){return this._storage||(this._storage=t.sdk.deviceManager.getDeviceStorage(this.nativeId)),this._storage}get log(){return this._log||(this._log=t.sdk.deviceManager.getDeviceLogger(this.nativeId)),this._log}get console(){return this._console||(this._console=t.sdk.deviceManager.getDeviceConsole(this.nativeId)),this._console}async createMediaObject(e,r){return t.sdk.mediaManager.createMediaObject(e,r,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:t.sdk.deviceManager.getMixinConsole(e.sourceId,this.nativeId)}_lazyLoadDeviceState(){this._deviceState||(this.nativeId?this._deviceState=t.sdk.deviceManager.getDeviceState(this.nativeId):this._deviceState=t.sdk.deviceManager.getDeviceState())}onDeviceEvent(e,r){return t.sdk.deviceManager.onDeviceEvent(this.nativeId,e,r)}}t.ScryptedDeviceBase=n;class a extends s.DeviceBase{constructor(e){super(),this._listeners=new Set,this.mixinDevice=e.mixinDevice,this.mixinDeviceInterfaces=e.mixinDeviceInterfaces,this.mixinStorageSuffix=e.mixinStorageSuffix,this._deviceState=e.mixinDeviceState,this.nativeId=t.sdk.systemManager.getDeviceById(this.id).nativeId,this.mixinProviderNativeId=e.mixinProviderNativeId,this._deviceState.__rpcproxy_traps_all_properties&&"string"==typeof this._deviceState.id&&(this._deviceState=t.sdk.deviceManager.createDeviceState(this._deviceState.id,this._deviceState.setState))}get storage(){if(!this._storage){const e=this.mixinStorageSuffix,r=this.id+(e?":"+e:"");this._storage=t.sdk.deviceManager.getMixinStorage(r,this.mixinProviderNativeId)}return this._storage}get console(){return this._console||(t.sdk.deviceManager.getMixinConsole?this._console=t.sdk.deviceManager.getMixinConsole(this.id,this.mixinProviderNativeId):this._console=t.sdk.deviceManager.getDeviceConsole(this.mixinProviderNativeId)),this._console}async createMediaObject(e,r){return t.sdk.mediaManager.createMediaObject(e,r,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:t.sdk.deviceManager.getMixinConsole(e.sourceId,this.mixinProviderNativeId)}onDeviceEvent(e,r){return t.sdk.deviceManager.onMixinEvent(this.id,this,e,r)}_lazyLoadDeviceState(){}manageListener(e){this._listeners.add(e)}release(){for(const e of this._listeners)e.removeListener()}}t.MixinDeviceBase=a,function(){function e(e){return function(){return this._lazyLoadDeviceState(),this._deviceState?.[e]}}function t(e){return function(t){this._lazyLoadDeviceState(),this._deviceState?this._deviceState[e]=t:console.warn("device state is unavailable. the device must be discovered with deviceManager.onDeviceDiscovered or deviceManager.onDevicesChanged before the state can be set.")}}for(const r of Object.values(s.ScryptedInterfaceProperty))r!==s.ScryptedInterfaceProperty.nativeId&&(Object.defineProperty(n.prototype,r,{set:t(r),get:e(r)}),Object.defineProperty(a.prototype,r,{set:t(r),get:e(r)}))}(),t.sdk={};try{let e=!1;try{process.env.SCRYPTED_SDK_ES_MODULE||process.env.SCRYPTED_SDK_MODULE;const i=process.env.SCRYPTED_SDK_CJS_MODULE||process.env.SCRYPTED_SDK_MODULE;if(i)if("undefined"!=typeof require){const r=require(process.env.SCRYPTED_SDK_MODULE);Object.assign(t.sdk,r.getScryptedStatic()),e=!0}else{const o=r(891)(i);Object.assign(t.sdk,o.getScryptedStatic()),e=!0}}catch(e){throw console.warn("failed to load sdk module",e),e}if(!e){let e;try{e=pluginRuntimeAPI}catch(e){}Object.assign(t.sdk,{log:deviceManager.getDeviceLogger(void 0),deviceManager,endpointManager,mediaManager,systemManager,pluginHostAPI,...e})}try{t.sdk.systemManager.setScryptedInterfaceDescriptors?.(s.TYPES_VERSION,s.ScryptedInterfaceDescriptors)?.catch((()=>{}))}catch(e){}}catch(e){console.error("sdk initialization error, import @scrypted/types or use @scrypted/client instead",e)}t.default=t.sdk},891:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=891,e.exports=t},192:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScryptedMimeTypes=t.ScryptedInterface=t.MediaPlayerState=t.SecuritySystemObstruction=t.SecuritySystemMode=t.AirQuality=t.AirPurifierMode=t.AirPurifierStatus=t.ChargeState=t.LockState=t.PanTiltZoomMovement=t.ThermostatMode=t.TemperatureUnit=t.FanMode=t.HumidityMode=t.ScryptedDeviceType=t.ScryptedInterfaceDescriptors=t.ScryptedInterfaceMethod=t.ScryptedInterfaceProperty=t.DeviceBase=t.TYPES_VERSION=void 0,t.TYPES_VERSION="0.3.107";var r,i,o,s,n,a,c,d,p,m,l,u,g,h,S,y,v,f;t.DeviceBase=class{},function(e){e.id="id",e.info="info",e.interfaces="interfaces",e.mixins="mixins",e.name="name",e.nativeId="nativeId",e.pluginId="pluginId",e.providedInterfaces="providedInterfaces",e.providedName="providedName",e.providedRoom="providedRoom",e.providedType="providedType",e.providerId="providerId",e.room="room",e.type="type",e.scryptedRuntimeArguments="scryptedRuntimeArguments",e.on="on",e.brightness="brightness",e.colorTemperature="colorTemperature",e.rgb="rgb",e.hsv="hsv",e.buttons="buttons",e.running="running",e.paused="paused",e.docked="docked",e.temperatureSetting="temperatureSetting",e.temperature="temperature",e.temperatureUnit="temperatureUnit",e.humidity="humidity",e.audioVolumes="audioVolumes",e.recordingActive="recordingActive",e.ptzCapabilities="ptzCapabilities",e.lockState="lockState",e.entryOpen="entryOpen",e.batteryLevel="batteryLevel",e.chargeState="chargeState",e.online="online",e.fromMimeType="fromMimeType",e.toMimeType="toMimeType",e.converters="converters",e.binaryState="binaryState",e.tampered="tampered",e.sleeping="sleeping",e.powerDetected="powerDetected",e.audioDetected="audioDetected",e.motionDetected="motionDetected",e.ambientLight="ambientLight",e.occupied="occupied",e.flooded="flooded",e.ultraviolet="ultraviolet",e.luminance="luminance",e.position="position",e.securitySystemState="securitySystemState",e.pm10Density="pm10Density",e.pm25Density="pm25Density",e.vocDensity="vocDensity",e.noxDensity="noxDensity",e.co2ppm="co2ppm",e.airQuality="airQuality",e.airPurifierState="airPurifierState",e.filterChangeIndication="filterChangeIndication",e.filterLifeLevel="filterLifeLevel",e.humiditySetting="humiditySetting",e.fan="fan",e.applicationInfo="applicationInfo",e.systemDevice="systemDevice"}(r||(t.ScryptedInterfaceProperty=r={})),function(e){e.listen="listen",e.probe="probe",e.setMixins="setMixins",e.setName="setName",e.setRoom="setRoom",e.setType="setType",e.getPluginJson="getPluginJson",e.turnOff="turnOff",e.turnOn="turnOn",e.setBrightness="setBrightness",e.getTemperatureMaxK="getTemperatureMaxK",e.getTemperatureMinK="getTemperatureMinK",e.setColorTemperature="setColorTemperature",e.setRgb="setRgb",e.setHsv="setHsv",e.pressButton="pressButton",e.sendNotification="sendNotification",e.start="start",e.stop="stop",e.pause="pause",e.resume="resume",e.dock="dock",e.setTemperature="setTemperature",e.setTemperatureUnit="setTemperatureUnit",e.getPictureOptions="getPictureOptions",e.takePicture="takePicture",e.getAudioStream="getAudioStream",e.setAudioVolumes="setAudioVolumes",e.startDisplay="startDisplay",e.stopDisplay="stopDisplay",e.getVideoStream="getVideoStream",e.getVideoStreamOptions="getVideoStreamOptions",e.getPrivacyMasks="getPrivacyMasks",e.setPrivacyMasks="setPrivacyMasks",e.getVideoTextOverlays="getVideoTextOverlays",e.setVideoTextOverlay="setVideoTextOverlay",e.getRecordingStream="getRecordingStream",e.getRecordingStreamCurrentTime="getRecordingStreamCurrentTime",e.getRecordingStreamOptions="getRecordingStreamOptions",e.getRecordingStreamThumbnail="getRecordingStreamThumbnail",e.deleteRecordingStream="deleteRecordingStream",e.setRecordingActive="setRecordingActive",e.ptzCommand="ptzCommand",e.getRecordedEvents="getRecordedEvents",e.getVideoClip="getVideoClip",e.getVideoClips="getVideoClips",e.getVideoClipThumbnail="getVideoClipThumbnail",e.removeVideoClips="removeVideoClips",e.setVideoStreamOptions="setVideoStreamOptions",e.startIntercom="startIntercom",e.stopIntercom="stopIntercom",e.lock="lock",e.unlock="unlock",e.addPassword="addPassword",e.getPasswords="getPasswords",e.removePassword="removePassword",e.activate="activate",e.deactivate="deactivate",e.isReversible="isReversible",e.closeEntry="closeEntry",e.openEntry="openEntry",e.getDevice="getDevice",e.releaseDevice="releaseDevice",e.adoptDevice="adoptDevice",e.discoverDevices="discoverDevices",e.createDevice="createDevice",e.getCreateDeviceSettings="getCreateDeviceSettings",e.reboot="reboot",e.getRefreshFrequency="getRefreshFrequency",e.refresh="refresh",e.getMediaStatus="getMediaStatus",e.load="load",e.seek="seek",e.skipNext="skipNext",e.skipPrevious="skipPrevious",e.convert="convert",e.convertMedia="convertMedia",e.getSettings="getSettings",e.putSetting="putSetting",e.armSecuritySystem="armSecuritySystem",e.disarmSecuritySystem="disarmSecuritySystem",e.setAirPurifierState="setAirPurifierState",e.getReadmeMarkdown="getReadmeMarkdown",e.getOauthUrl="getOauthUrl",e.onOauthCallback="onOauthCallback",e.canMixin="canMixin",e.getMixin="getMixin",e.releaseMixin="releaseMixin",e.onRequest="onRequest",e.onConnection="onConnection",e.onPush="onPush",e.run="run",e.eval="eval",e.loadScripts="loadScripts",e.saveScript="saveScript",e.forkInterface="forkInterface",e.trackObjects="trackObjects",e.getDetectionInput="getDetectionInput",e.getObjectTypes="getObjectTypes",e.detectObjects="detectObjects",e.generateObjectDetections="generateObjectDetections",e.getDetectionModel="getDetectionModel",e.setHumidity="setHumidity",e.setFan="setFan",e.startRTCSignalingSession="startRTCSignalingSession",e.createRTCSignalingSession="createRTCSignalingSession",e.getScryptedUserAccessControl="getScryptedUserAccessControl",e.generateVideoFrames="generateVideoFrames",e.connectStream="connectStream",e.getTTYSettings="getTTYSettings"}(i||(t.ScryptedInterfaceMethod=i={})),t.ScryptedInterfaceDescriptors={ScryptedDevice:{name:"ScryptedDevice",methods:["listen","probe","setMixins","setName","setRoom","setType"],properties:["id","info","interfaces","mixins","name","nativeId","pluginId","providedInterfaces","providedName","providedRoom","providedType","providerId","room","type"]},ScryptedPlugin:{name:"ScryptedPlugin",methods:["getPluginJson"],properties:[]},ScryptedPluginRuntime:{name:"ScryptedPluginRuntime",methods:[],properties:["scryptedRuntimeArguments"]},OnOff:{name:"OnOff",methods:["turnOff","turnOn"],properties:["on"]},Brightness:{name:"Brightness",methods:["setBrightness"],properties:["brightness"]},ColorSettingTemperature:{name:"ColorSettingTemperature",methods:["getTemperatureMaxK","getTemperatureMinK","setColorTemperature"],properties:["colorTemperature"]},ColorSettingRgb:{name:"ColorSettingRgb",methods:["setRgb"],properties:["rgb"]},ColorSettingHsv:{name:"ColorSettingHsv",methods:["setHsv"],properties:["hsv"]},Buttons:{name:"Buttons",methods:[],properties:["buttons"]},PressButtons:{name:"PressButtons",methods:["pressButton"],properties:[]},Notifier:{name:"Notifier",methods:["sendNotification"],properties:[]},StartStop:{name:"StartStop",methods:["start","stop"],properties:["running"]},Pause:{name:"Pause",methods:["pause","resume"],properties:["paused"]},Dock:{name:"Dock",methods:["dock"],properties:["docked"]},TemperatureSetting:{name:"TemperatureSetting",methods:["setTemperature"],properties:["temperatureSetting"]},Thermometer:{name:"Thermometer",methods:["setTemperatureUnit"],properties:["temperature","temperatureUnit"]},HumiditySensor:{name:"HumiditySensor",methods:[],properties:["humidity"]},Camera:{name:"Camera",methods:["getPictureOptions","takePicture"],properties:[]},Microphone:{name:"Microphone",methods:["getAudioStream"],properties:[]},AudioVolumeControl:{name:"AudioVolumeControl",methods:["setAudioVolumes"],properties:["audioVolumes"]},Display:{name:"Display",methods:["startDisplay","stopDisplay"],properties:[]},VideoCamera:{name:"VideoCamera",methods:["getVideoStream","getVideoStreamOptions"],properties:[]},VideoCameraMask:{name:"VideoCameraMask",methods:["getPrivacyMasks","setPrivacyMasks"],properties:[]},VideoTextOverlays:{name:"VideoTextOverlays",methods:["getVideoTextOverlays","setVideoTextOverlay"],properties:[]},VideoRecorder:{name:"VideoRecorder",methods:["getRecordingStream","getRecordingStreamCurrentTime","getRecordingStreamOptions","getRecordingStreamThumbnail"],properties:["recordingActive"]},VideoRecorderManagement:{name:"VideoRecorderManagement",methods:["deleteRecordingStream","setRecordingActive"],properties:[]},PanTiltZoom:{name:"PanTiltZoom",methods:["ptzCommand"],properties:["ptzCapabilities"]},EventRecorder:{name:"EventRecorder",methods:["getRecordedEvents"],properties:[]},VideoClips:{name:"VideoClips",methods:["getVideoClip","getVideoClips","getVideoClipThumbnail","removeVideoClips"],properties:[]},VideoCameraConfiguration:{name:"VideoCameraConfiguration",methods:["setVideoStreamOptions"],properties:[]},Intercom:{name:"Intercom",methods:["startIntercom","stopIntercom"],properties:[]},Lock:{name:"Lock",methods:["lock","unlock"],properties:["lockState"]},PasswordStore:{name:"PasswordStore",methods:["addPassword","getPasswords","removePassword"],properties:[]},Scene:{name:"Scene",methods:["activate","deactivate","isReversible"],properties:[]},Entry:{name:"Entry",methods:["closeEntry","openEntry"],properties:[]},EntrySensor:{name:"EntrySensor",methods:[],properties:["entryOpen"]},DeviceProvider:{name:"DeviceProvider",methods:["getDevice","releaseDevice"],properties:[]},DeviceDiscovery:{name:"DeviceDiscovery",methods:["adoptDevice","discoverDevices"],properties:[]},DeviceCreator:{name:"DeviceCreator",methods:["createDevice","getCreateDeviceSettings"],properties:[]},Battery:{name:"Battery",methods:[],properties:["batteryLevel"]},Charger:{name:"Charger",methods:[],properties:["chargeState"]},Reboot:{name:"Reboot",methods:["reboot"],properties:[]},Refresh:{name:"Refresh",methods:["getRefreshFrequency","refresh"],properties:[]},MediaPlayer:{name:"MediaPlayer",methods:["getMediaStatus","load","seek","skipNext","skipPrevious"],properties:[]},Online:{name:"Online",methods:[],properties:["online"]},BufferConverter:{name:"BufferConverter",methods:["convert"],properties:["fromMimeType","toMimeType"]},MediaConverter:{name:"MediaConverter",methods:["convertMedia"],properties:["converters"]},Settings:{name:"Settings",methods:["getSettings","putSetting"],properties:[]},BinarySensor:{name:"BinarySensor",methods:[],properties:["binaryState"]},TamperSensor:{name:"TamperSensor",methods:[],properties:["tampered"]},Sleep:{name:"Sleep",methods:[],properties:["sleeping"]},PowerSensor:{name:"PowerSensor",methods:[],properties:["powerDetected"]},AudioSensor:{name:"AudioSensor",methods:[],properties:["audioDetected"]},MotionSensor:{name:"MotionSensor",methods:[],properties:["motionDetected"]},AmbientLightSensor:{name:"AmbientLightSensor",methods:[],properties:["ambientLight"]},OccupancySensor:{name:"OccupancySensor",methods:[],properties:["occupied"]},FloodSensor:{name:"FloodSensor",methods:[],properties:["flooded"]},UltravioletSensor:{name:"UltravioletSensor",methods:[],properties:["ultraviolet"]},LuminanceSensor:{name:"LuminanceSensor",methods:[],properties:["luminance"]},PositionSensor:{name:"PositionSensor",methods:[],properties:["position"]},SecuritySystem:{name:"SecuritySystem",methods:["armSecuritySystem","disarmSecuritySystem"],properties:["securitySystemState"]},PM10Sensor:{name:"PM10Sensor",methods:[],properties:["pm10Density"]},PM25Sensor:{name:"PM25Sensor",methods:[],properties:["pm25Density"]},VOCSensor:{name:"VOCSensor",methods:[],properties:["vocDensity"]},NOXSensor:{name:"NOXSensor",methods:[],properties:["noxDensity"]},CO2Sensor:{name:"CO2Sensor",methods:[],properties:["co2ppm"]},AirQualitySensor:{name:"AirQualitySensor",methods:[],properties:["airQuality"]},AirPurifier:{name:"AirPurifier",methods:["setAirPurifierState"],properties:["airPurifierState"]},FilterMaintenance:{name:"FilterMaintenance",methods:[],properties:["filterChangeIndication","filterLifeLevel"]},Readme:{name:"Readme",methods:["getReadmeMarkdown"],properties:[]},OauthClient:{name:"OauthClient",methods:["getOauthUrl","onOauthCallback"],properties:[]},MixinProvider:{name:"MixinProvider",methods:["canMixin","getMixin","releaseMixin"],properties:[]},HttpRequestHandler:{name:"HttpRequestHandler",methods:["onRequest"],properties:[]},EngineIOHandler:{name:"EngineIOHandler",methods:["onConnection"],properties:[]},PushHandler:{name:"PushHandler",methods:["onPush"],properties:[]},Program:{name:"Program",methods:["run"],properties:[]},Scriptable:{name:"Scriptable",methods:["eval","loadScripts","saveScript"],properties:[]},ClusterForkInterface:{name:"ClusterForkInterface",methods:["forkInterface"],properties:[]},ObjectTracker:{name:"ObjectTracker",methods:["trackObjects"],properties:[]},ObjectDetector:{name:"ObjectDetector",methods:["getDetectionInput","getObjectTypes"],properties:[]},ObjectDetection:{name:"ObjectDetection",methods:["detectObjects","generateObjectDetections","getDetectionModel"],properties:[]},ObjectDetectionPreview:{name:"ObjectDetectionPreview",methods:[],properties:[]},ObjectDetectionGenerator:{name:"ObjectDetectionGenerator",methods:[],properties:[]},HumiditySetting:{name:"HumiditySetting",methods:["setHumidity"],properties:["humiditySetting"]},Fan:{name:"Fan",methods:["setFan"],properties:["fan"]},RTCSignalingChannel:{name:"RTCSignalingChannel",methods:["startRTCSignalingSession"],properties:[]},RTCSignalingClient:{name:"RTCSignalingClient",methods:["createRTCSignalingSession"],properties:[]},LauncherApplication:{name:"LauncherApplication",methods:[],properties:["applicationInfo"]},ScryptedUser:{name:"ScryptedUser",methods:["getScryptedUserAccessControl"],properties:[]},VideoFrameGenerator:{name:"VideoFrameGenerator",methods:["generateVideoFrames"],properties:[]},StreamService:{name:"StreamService",methods:["connectStream"],properties:[]},TTY:{name:"TTY",methods:[],properties:[]},TTYSettings:{name:"TTYSettings",methods:["getTTYSettings"],properties:[]},ScryptedSystemDevice:{name:"ScryptedSystemDevice",methods:[],properties:["systemDevice"]},ScryptedDeviceCreator:{name:"ScryptedDeviceCreator",methods:[],properties:[]},ScryptedSettings:{name:"ScryptedSettings",methods:[],properties:[]}},function(e){e.Builtin="Builtin",e.Camera="Camera",e.Fan="Fan",e.Light="Light",e.Switch="Switch",e.Outlet="Outlet",e.Sensor="Sensor",e.Scene="Scene",e.Program="Program",e.Automation="Automation",e.Vacuum="Vacuum",e.Notifier="Notifier",e.Thermostat="Thermostat",e.Lock="Lock",e.PasswordControl="PasswordControl",e.Display="Display",e.SmartDisplay="SmartDisplay",e.Speaker="Speaker",e.SmartSpeaker="SmartSpeaker",e.Event="Event",e.Entry="Entry",e.Garage="Garage",e.DeviceProvider="DeviceProvider",e.DataSource="DataSource",e.API="API",e.Doorbell="Doorbell",e.Irrigation="Irrigation",e.Valve="Valve",e.Person="Person",e.SecuritySystem="SecuritySystem",e.WindowCovering="WindowCovering",e.Siren="Siren",e.AirPurifier="AirPurifier",e.Unknown="Unknown"}(o||(t.ScryptedDeviceType=o={})),function(e){e.Humidify="Humidify",e.Dehumidify="Dehumidify",e.Auto="Auto",e.Off="Off"}(s||(t.HumidityMode=s={})),function(e){e.Auto="Auto",e.Manual="Manual"}(n||(t.FanMode=n={})),function(e){e.C="C",e.F="F"}(a||(t.TemperatureUnit=a={})),function(e){e.Off="Off",e.Cool="Cool",e.Heat="Heat",e.HeatCool="HeatCool",e.Auto="Auto",e.FanOnly="FanOnly",e.Purifier="Purifier",e.Eco="Eco",e.Dry="Dry",e.On="On"}(c||(t.ThermostatMode=c={})),function(e){e.Absolute="Absolute",e.Relative="Relative",e.Continuous="Continuous",e.Preset="Preset",e.Home="Home"}(d||(t.PanTiltZoomMovement=d={})),function(e){e.Locked="Locked",e.Unlocked="Unlocked",e.Jammed="Jammed"}(p||(t.LockState=p={})),function(e){e.Trickle="trickle",e.Charging="charging",e.NotCharging="not-charging"}(m||(t.ChargeState=m={})),function(e){e.Inactive="Inactive",e.Idle="Idle",e.Active="Active",e.ActiveNightMode="ActiveNightMode"}(l||(t.AirPurifierStatus=l={})),function(e){e.Manual="Manual",e.Automatic="Automatic"}(u||(t.AirPurifierMode=u={})),function(e){e.Unknown="Unknown",e.Excellent="Excellent",e.Good="Good",e.Fair="Fair",e.Inferior="Inferior",e.Poor="Poor"}(g||(t.AirQuality=g={})),function(e){e.Disarmed="Disarmed",e.HomeArmed="HomeArmed",e.AwayArmed="AwayArmed",e.NightArmed="NightArmed"}(h||(t.SecuritySystemMode=h={})),function(e){e.Sensor="Sensor",e.Occupied="Occupied",e.Time="Time",e.Error="Error"}(S||(t.SecuritySystemObstruction=S={})),function(e){e.Idle="Idle",e.Playing="Playing",e.Paused="Paused",e.Buffering="Buffering"}(y||(t.MediaPlayerState=y={})),function(e){e.ScryptedDevice="ScryptedDevice",e.ScryptedPlugin="ScryptedPlugin",e.ScryptedPluginRuntime="ScryptedPluginRuntime",e.OnOff="OnOff",e.Brightness="Brightness",e.ColorSettingTemperature="ColorSettingTemperature",e.ColorSettingRgb="ColorSettingRgb",e.ColorSettingHsv="ColorSettingHsv",e.Buttons="Buttons",e.PressButtons="PressButtons",e.Notifier="Notifier",e.StartStop="StartStop",e.Pause="Pause",e.Dock="Dock",e.TemperatureSetting="TemperatureSetting",e.Thermometer="Thermometer",e.HumiditySensor="HumiditySensor",e.Camera="Camera",e.Microphone="Microphone",e.AudioVolumeControl="AudioVolumeControl",e.Display="Display",e.VideoCamera="VideoCamera",e.VideoCameraMask="VideoCameraMask",e.VideoTextOverlays="VideoTextOverlays",e.VideoRecorder="VideoRecorder",e.VideoRecorderManagement="VideoRecorderManagement",e.PanTiltZoom="PanTiltZoom",e.EventRecorder="EventRecorder",e.VideoClips="VideoClips",e.VideoCameraConfiguration="VideoCameraConfiguration",e.Intercom="Intercom",e.Lock="Lock",e.PasswordStore="PasswordStore",e.Scene="Scene",e.Entry="Entry",e.EntrySensor="EntrySensor",e.DeviceProvider="DeviceProvider",e.DeviceDiscovery="DeviceDiscovery",e.DeviceCreator="DeviceCreator",e.Battery="Battery",e.Charger="Charger",e.Reboot="Reboot",e.Refresh="Refresh",e.MediaPlayer="MediaPlayer",e.Online="Online",e.BufferConverter="BufferConverter",e.MediaConverter="MediaConverter",e.Settings="Settings",e.BinarySensor="BinarySensor",e.TamperSensor="TamperSensor",e.Sleep="Sleep",e.PowerSensor="PowerSensor",e.AudioSensor="AudioSensor",e.MotionSensor="MotionSensor",e.AmbientLightSensor="AmbientLightSensor",e.OccupancySensor="OccupancySensor",e.FloodSensor="FloodSensor",e.UltravioletSensor="UltravioletSensor",e.LuminanceSensor="LuminanceSensor",e.PositionSensor="PositionSensor",e.SecuritySystem="SecuritySystem",e.PM10Sensor="PM10Sensor",e.PM25Sensor="PM25Sensor",e.VOCSensor="VOCSensor",e.NOXSensor="NOXSensor",e.CO2Sensor="CO2Sensor",e.AirQualitySensor="AirQualitySensor",e.AirPurifier="AirPurifier",e.FilterMaintenance="FilterMaintenance",e.Readme="Readme",e.OauthClient="OauthClient",e.MixinProvider="MixinProvider",e.HttpRequestHandler="HttpRequestHandler",e.EngineIOHandler="EngineIOHandler",e.PushHandler="PushHandler",e.Program="Program",e.Scriptable="Scriptable",e.ClusterForkInterface="ClusterForkInterface",e.ObjectTracker="ObjectTracker",e.ObjectDetector="ObjectDetector",e.ObjectDetection="ObjectDetection",e.ObjectDetectionPreview="ObjectDetectionPreview",e.ObjectDetectionGenerator="ObjectDetectionGenerator",e.HumiditySetting="HumiditySetting",e.Fan="Fan",e.RTCSignalingChannel="RTCSignalingChannel",e.RTCSignalingClient="RTCSignalingClient",e.LauncherApplication="LauncherApplication",e.ScryptedUser="ScryptedUser",e.VideoFrameGenerator="VideoFrameGenerator",e.StreamService="StreamService",e.TTY="TTY",e.TTYSettings="TTYSettings",e.ScryptedSystemDevice="ScryptedSystemDevice",e.ScryptedDeviceCreator="ScryptedDeviceCreator",e.ScryptedSettings="ScryptedSettings"}(v||(t.ScryptedInterface=v={})),function(e){e.Url="text/x-uri",e.InsecureLocalUrl="text/x-insecure-local-uri",e.LocalUrl="text/x-local-uri",e.ServerId="text/x-server-id",e.PushEndpoint="text/x-push-endpoint",e.SchemePrefix="x-scrypted/x-scrypted-scheme-",e.MediaStreamUrl="text/x-media-url",e.MediaObject="x-scrypted/x-scrypted-media-object",e.RequestMediaObject="x-scrypted/x-scrypted-request-media-object",e.RequestMediaStream="x-scrypted/x-scrypted-request-stream",e.MediaStreamFeedback="x-scrypted/x-media-stream-feedback",e.FFmpegInput="x-scrypted/x-ffmpeg-input",e.FFmpegTranscodeStream="x-scrypted/x-ffmpeg-transcode-stream",e.RTCSignalingChannel="x-scrypted/x-scrypted-rtc-signaling-channel",e.RTCSignalingSession="x-scrypted/x-scrypted-rtc-signaling-session",e.RTCConnectionManagement="x-scrypted/x-scrypted-rtc-connection-management",e.Image="x-scrypted/x-scrypted-image"}(f||(t.ScryptedMimeTypes=f={}))},304:e=>{"use strict";function t(e){if(this.size=0|e,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=e<<1;for(var t=new Array(2*this.size),r=0;r<t.length;r+=2){const e=Math.PI*r/this.size;t[r]=Math.cos(e),t[r+1]=-Math.sin(e)}this.table=t;for(var i=0,o=1;this.size>o;o<<=1)i++;this._width=i%2==0?i-1:i,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var n=0;n<this._width;n+=2){var a=this._width-n-2;this._bitrev[s]|=(s>>>n&3)<<a}}this._out=null,this._data=null,this._inv=0}e.exports=t,t.prototype.fromComplexArray=function(e,t){for(var r=t||new Array(e.length>>>1),i=0;i<e.length;i+=2)r[i>>>1]=e[i];return r},t.prototype.createComplexArray=function(){const e=new Array(this._csize);for(var t=0;t<e.length;t++)e[t]=0;return e},t.prototype.toComplexArray=function(e,t){for(var r=t||this.createComplexArray(),i=0;i<r.length;i+=2)r[i]=e[i>>>1],r[i+1]=0;return r},t.prototype.completeSpectrum=function(e){for(var t=this._csize,r=t>>>1,i=2;i<r;i+=2)e[t-i]=e[i],e[t-i+1]=-e[i+1]},t.prototype.transform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._transform4(),this._out=null,this._data=null},t.prototype.realTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._realTransform4(),this._out=null,this._data=null},t.prototype.inverseTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=1,this._transform4();for(var r=0;r<e.length;r++)e[r]/=this.size;this._out=null,this._data=null},t.prototype._transform4=function(){var e,t,r=this._out,i=this._csize,o=1<<this._width,s=i/o<<1,n=this._bitrev;if(4===s)for(e=0,t=0;e<i;e+=s,t++){const r=n[t];this._singleTransform2(e,r,o)}else for(e=0,t=0;e<i;e+=s,t++){const r=n[t];this._singleTransform4(e,r,o)}var a=this._inv?-1:1,c=this.table;for(o>>=2;o>=2;o>>=2){var d=(s=i/o<<1)>>>2;for(e=0;e<i;e+=s)for(var p=e+d,m=e,l=0;m<p;m+=2,l+=o){const e=m,t=e+d,i=t+d,o=i+d,s=r[e],n=r[e+1],p=r[t],u=r[t+1],g=r[i],h=r[i+1],S=r[o],y=r[o+1],v=s,f=n,D=c[l],P=a*c[l+1],T=p*D-u*P,M=p*P+u*D,C=c[2*l],b=a*c[2*l+1],O=g*C-h*b,_=g*b+h*C,x=c[3*l],R=a*c[3*l+1],I=S*x-y*R,w=S*R+y*x,k=v+O,A=f+_,E=v-O,V=f-_,L=T+I,B=M+w,U=a*(T-I),N=a*(M-w),F=k+L,j=A+B,H=k-L,z=A-B,Y=E+N,q=V-U,G=E-N,K=V+U;r[e]=F,r[e+1]=j,r[t]=Y,r[t+1]=q,r[i]=H,r[i+1]=z,r[o]=G,r[o+1]=K}}},t.prototype._singleTransform2=function(e,t,r){const i=this._out,o=this._data,s=o[t],n=o[t+1],a=o[t+r],c=o[t+r+1],d=s+a,p=n+c,m=s-a,l=n-c;i[e]=d,i[e+1]=p,i[e+2]=m,i[e+3]=l},t.prototype._singleTransform4=function(e,t,r){const i=this._out,o=this._data,s=this._inv?-1:1,n=2*r,a=3*r,c=o[t],d=o[t+1],p=o[t+r],m=o[t+r+1],l=o[t+n],u=o[t+n+1],g=o[t+a],h=o[t+a+1],S=c+l,y=d+u,v=c-l,f=d-u,D=p+g,P=m+h,T=s*(p-g),M=s*(m-h),C=S+D,b=y+P,O=v+M,_=f-T,x=S-D,R=y-P,I=v-M,w=f+T;i[e]=C,i[e+1]=b,i[e+2]=O,i[e+3]=_,i[e+4]=x,i[e+5]=R,i[e+6]=I,i[e+7]=w},t.prototype._realTransform4=function(){var e,t,r=this._out,i=this._csize,o=1<<this._width,s=i/o<<1,n=this._bitrev;if(4===s)for(e=0,t=0;e<i;e+=s,t++){const r=n[t];this._singleRealTransform2(e,r>>>1,o>>>1)}else for(e=0,t=0;e<i;e+=s,t++){const r=n[t];this._singleRealTransform4(e,r>>>1,o>>>1)}var a=this._inv?-1:1,c=this.table;for(o>>=2;o>=2;o>>=2){var d=(s=i/o<<1)>>>1,p=d>>>1,m=p>>>1;for(e=0;e<i;e+=s)for(var l=0,u=0;l<=m;l+=2,u+=o){var g=e+l,h=g+p,S=h+p,y=S+p,v=r[g],f=r[g+1],D=r[h],P=r[h+1],T=r[S],M=r[S+1],C=r[y],b=r[y+1],O=v,_=f,x=c[u],R=a*c[u+1],I=D*x-P*R,w=D*R+P*x,k=c[2*u],A=a*c[2*u+1],E=T*k-M*A,V=T*A+M*k,L=c[3*u],B=a*c[3*u+1],U=C*L-b*B,N=C*B+b*L,F=O+E,j=_+V,H=O-E,z=_-V,Y=I+U,q=w+N,G=a*(I-U),K=a*(w-N),$=F+Y,Q=j+q,J=H+K,Z=z-G;if(r[g]=$,r[g+1]=Q,r[h]=J,r[h+1]=Z,0!==l){if(l!==m){var X=H+-a*K,W=-z+-a*G,ee=F+-a*Y,te=-j- -a*q,re=e+p-l,ie=e+d-l;r[re]=X,r[re+1]=W,r[ie]=ee,r[ie+1]=te}}else{var oe=F-Y,se=j-q;r[S]=oe,r[S+1]=se}}}},t.prototype._singleRealTransform2=function(e,t,r){const i=this._out,o=this._data,s=o[t],n=o[t+r],a=s+n,c=s-n;i[e]=a,i[e+1]=0,i[e+2]=c,i[e+3]=0},t.prototype._singleRealTransform4=function(e,t,r){const i=this._out,o=this._data,s=this._inv?-1:1,n=2*r,a=3*r,c=o[t],d=o[t+r],p=o[t+n],m=o[t+a],l=c+p,u=c-p,g=d+m,h=s*(d-m),S=l+g,y=u,v=-h,f=l-g,D=u,P=h;i[e]=S,i[e+1]=0,i[e+2]=y,i[e+3]=v,i[e+4]=f,i[e+5]=0,i[e+6]=D,i[e+7]=P}},757:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.predict=t.createSpectrogram=t.loadModelAndLabels=void 0;const o=i(r(562)),s=i(r(304)),n=r(896),a=r(928),{systemManager:c}=o.default;let d;const p=2048,m=(0,a.join)(process.env.SCRYPTED_PLUGIN_PATH||"","models/BirdNET_GLOBAL_6K_V2.4_Model_FP16.tflite"),l=(0,a.join)(process.env.SCRYPTED_PLUGIN_PATH||"","models/labels_en.txt");function u(e){return 2595*Math.log10(1+e/700)}t.loadModelAndLabels=async function(){try{d=await async function(){return d||(d=await c.getComponent("tensorflow-lite")),d}();const e=(0,n.readFileSync)(m),t=(0,n.readFileSync)(l,"utf8").split("\n").map((e=>e.trim())).filter((e=>e.length>0));return{model:await d.loadModel(e),labels:t}}catch(e){throw console.error("Error loading model/labels:",e),e}},t.createSpectrogram=async function(e){try{const t=[];for(let r=0;r<e.length-p;r+=1024){const i=e.slice(r,r+p);t.push(i)}const r=new s.default(p),i=t.map((e=>{const t=e.map(((e,t)=>e*(.5-.5*Math.cos(2*Math.PI*t/2047)))),i=r.createComplexArray();r.realTransform(i,t);const o=new Float32Array(1025);for(let e=0;e<o.length;e++){const t=i[2*e],r=i[2*e+1];o[e]=Math.sqrt(t*t+r*r)}return o})),o=function(e,t,r){const i=u(t/2),o=u(0),s=(i-o)/(r+1),n=Array.from({length:r+2},((e,t)=>o+s*t)).map((e=>function(e){return 700*(Math.pow(10,e/2595)-1)}(e))),a=new Array(r).fill(0).map((()=>new Float32Array(e)));for(let i=0;i<r;i++){const r=n[i],o=n[i+1],s=n[i+2];for(let n=0;n<e;n++){const c=n*t/(2*e);c>=r&&c<=s&&(a[i][n]=c<=o?(c-r)/(o-r):(s-c)/(s-o))}}return a}(1025,48e3,128),n=i.map((e=>{return t=e,o.map((e=>{let r=0;for(let i=0;i<t.length;i++)r+=t[i]*e[i];return r}));var t})),a=new Float32Array(n.flat());return await d.createTensor(a,[1,n.length,128,1])}catch(e){throw console.error("Error creating spectrogram:",e),e}},t.predict=async function(e,t){try{return await e.predict(t)}catch(e){throw console.error("Error during prediction:",e),e}}},803:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(562),s=r(317),n=r(203),a=r(757),c=i(r(611));class d extends o.ScryptedDeviceBase{constructor(e){super(e),this.devices=new Map,this.birdnetProcess=null,this.audioStream=null,this.ffmpegAudioProcess=null,this.model=null,this.settings={},this.mediaManager=o.sdk.mediaManager,this.deviceManager=o.sdk.deviceManager,this.loadSettings(),"self-contained"===this.settings.mode&&this.initializeModel(),this.startBirdNET()}loadSettings(){this.settings.mode=this.storage.getItem("mode")||"self-contained",this.settings.birdnetUIURL=this.storage.getItem("birdnetUIURL")||"http://birdnet.local:8080",this.settings.audioSource=this.storage.getItem("audioSource")||"mic",this.settings.rtspAudioURL=this.storage.getItem("rtspAudioURL")||"",this.settings.birdnetThreshold=parseFloat(this.storage.getItem("birdnetThreshold")||"0.7")}async startBirdNET(){try{if("self-contained"===this.settings.mode){this.audioStream=new n.PassThrough,"rtsp"===this.settings.audioSource&&this.startAudioCapture();try{this.console.log("Starting BirdNET-Go...");try{await new Promise(((e,t)=>{(0,s.spawn)("which",["birdnet-go"]).on("exit",(r=>0===r?e(null):t()))}))}catch(e){throw new Error("BirdNET-Go not found. Please install BirdNET-Go first.")}this.birdnetProcess=(0,s.spawn)("birdnet-go",["realtime","--threshold",this.settings.birdnetThreshold.toString(),"--locale","en",..."rtsp"===this.settings.audioSource?["--audio-stdin"]:[]]),"rtsp"===this.settings.audioSource&&this.audioStream.pipe(this.birdnetProcess.stdin),this.birdnetProcess.stdout.on("data",(e=>{const t=e.toString().match(/Detected\s+(.+?)\s+\((0\.\d+)\)/);if(t){const[e,r,i]=t;(100*parseFloat(i)).toFixed(1);this.updateTTYDisplay([{species:r,confidence:parseFloat(i)}])}}))}catch(e){throw e instanceof Error&&(this.console.error("Failed to start BirdNET-Go:",e.message),process.stdout.write(`[31mError: ${e.message}[0m\n`)),e}}else this.pollExternalBirdNET()}catch(e){throw this.console.error("Error starting BirdNET:",e.message),process.stdout.write(`[31mError: ${e.message}[0m\n`),e}}pollExternalBirdNET(){setInterval((()=>{c.default.get(this.settings.birdnetUIURL,(e=>{let t="";e.on("data",(e=>t+=e)),e.on("end",(()=>{try{const e=JSON.parse(t);Array.isArray(e)&&this.updateTTYDisplay(e)}catch(e){process.stdout.write("[31mError parsing external BirdNET data[0m\n")}}))})).on("error",(e=>{process.stdout.write(`[31mError connecting to external BirdNET: ${e.message}[0m\n`)}))}),1e3)}updateTTYDisplay(e){process.stdout.write("c[H"),process.stdout.write("[1m=== BirdNET Detections ===[0m\n\n"),process.stdout.write(`Mode: ${this.settings.mode}\n`),"external"===this.settings.mode?process.stdout.write(`Source: ${this.settings.birdnetUIURL}\n`):process.stdout.write(`Audio: ${this.settings.audioSource}\n`),process.stdout.write("\n"),0===e.length?process.stdout.write("No birds detected\n"):e.forEach((({species:e,confidence:t})=>{const r=(100*t).toFixed(1);process.stdout.write(`[1m${e}[0m (${r}%)\n`)})),process.stdout.write("\n[2mPress Ctrl+C to exit[0m\n")}startAudioCapture(){"rtsp"===this.settings.audioSource&&(this.ffmpegAudioProcess=(0,s.spawn)("ffmpeg",["-i",this.settings.rtspAudioURL,"-vn","-acodec","pcm_s16le","-ar","48000","-ac","1","-f","wav","pipe:1"]),this.ffmpegAudioProcess.stdout.pipe(this.audioStream),this.ffmpegAudioProcess.on("error",(e=>{this.console.error("FFmpeg audio capture error:",e)})))}async getDevice(e){if(!this.devices.has(e)){const t=new p(e);this.devices.set(e,t)}return this.devices.get(e)}async createDevice(e){return e.nativeId}async getSettings(){return[{key:"mode",title:"Operation Mode",description:'Select "self-contained" or "external" mode',type:"string",value:this.settings.mode||"self-contained"},{key:"birdnetUIURL",title:"BirdNET UI URL",description:"URL for BirdNET UI when in external mode",type:"string",value:this.settings.birdnetUIURL||"http://birdnet.local:8080"},{key:"audioSource",title:"Audio Source",description:'Choose "mic" for local microphone or "rtsp" for RTSP audio feed',type:"string",value:this.settings.audioSource||"mic"},{key:"rtspAudioURL",title:"RTSP Audio URL",description:"RTSP URL for audio capture if using RTSP audio",type:"string",value:this.settings.rtspAudioURL||""},{key:"birdnetThreshold",title:"BirdNET Confidence Threshold",description:"Confidence threshold for bird detection (e.g., 0.7)",type:"number",value:this.settings.birdnetThreshold||.7}]}async putSetting(e,t){this.storage.setItem(e,t.toString()),this.settings[e]=t}dispose(){this.birdnetProcess&&(this.birdnetProcess.kill(),this.birdnetProcess=null),this.ffmpegAudioProcess&&(this.ffmpegAudioProcess.kill(),this.ffmpegAudioProcess=null),this.audioStream&&(this.audioStream.destroy(),this.audioStream=null)}async getCreateDeviceSettings(){return[{key:"name",title:"Device Name",type:"string"}]}async releaseDevice(e,t){}async initializeModel(){try{const{model:e,labels:t}=await(0,a.loadModelAndLabels)();this.model=e,this.labels=t,this.console.log("BirdNET model and labels loaded successfully")}catch(e){this.console.error("Failed to initialize BirdNET model:",e)}}async analyzeAudioChunk(e){try{if(!this.model)throw new Error("Model not loaded");const t=await(0,a.createSpectrogram)(e),r=await(0,a.predict)(this.model,t),i=this.postprocessResults(r);for(const e of i)e.confidence>=this.settings.birdnetThreshold&&this.console.log(`BirdNET Detection: ${e.species} (${(100*e.confidence).toFixed(1)}% confidence)`);t.dispose()}catch(e){this.console.error("Audio analysis error:",e)}}async getResource(e){return"external"===this.settings.mode?this.settings.birdnetUIURL:"http://localhost:8080"}postprocessResults(e){try{const t=r(Object(function(){var e=new Error("Cannot find module './labels.json'");throw e.code="MODULE_NOT_FOUND",e}())),i=[];for(let r=0;r<e.length;r++)e[r]>this.settings.birdnetThreshold&&i.push({species:t[r],confidence:e[r]});return i.sort(((e,t)=>t.confidence-e.confidence)),i}catch(e){throw this.console.error("Results post-processing error:",e),e}}}class p extends o.ScryptedDeviceBase{constructor(e){super(e),this.mediaManager=o.sdk.mediaManager}async getVideoStreamOptions(){return[{id:"default",name:"Default",video:{width:1280,height:720,fps:15},container:"rtsp"}]}async getVideoStream(e){const t=await o.sdk.systemManager.getDeviceByName("@scrypted/x11-camera");if(!t)throw new Error("Please install the x11-camera plugin from the Scrypted plugin store");const r=await t.createDevice({name:"BirdNET Display",type:o.ScryptedDeviceType.Camera,nativeId:this.nativeId+"_x11",interfaces:[o.ScryptedInterface.VideoCamera]});return(await o.sdk.systemManager.getDeviceById(r)).getVideoStream(e)}}t.default=d},317:e=>{"use strict";e.exports=require("child_process")},896:e=>{"use strict";e.exports=require("fs")},611:e=>{"use strict";e.exports=require("http")},339:e=>{"use strict";e.exports=require("module")},928:e=>{"use strict";e.exports=require("path")},203:e=>{"use strict";e.exports=require("stream")}},t={};function r(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,r),s.exports}r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i=r(803),o=exports="undefined"==typeof exports?{}:exports;for(var s in i)o[s]=i[s];i.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();
//# sourceMappingURL=main.nodejs.js.map